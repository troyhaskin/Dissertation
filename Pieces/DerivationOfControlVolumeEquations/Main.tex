% ===================================================================================== %
%                                        Header                                         %
% ===================================================================================== %
\documentclass[Prelim,12pt]{WisconsinThesis}

%\usepackage{bookmark}
\usepackage{import}
\usepackage{mathtools}
\usepackage{booktabs}
\usepackage{algorithm2e}
\usepackage{environ}
\usepackage{esint}
\usepackage{multirow}
\usepackage{microtype}

\input{HelperCommands}
\newcommand{\NeedReference}{\colorbox{yellow}{\textsc{need reference}}}
\DefaultFileName{Main}
\graphicspath{{./Graphics/}}

\let\bar\overline
\newcommand{\pdt}   {\partial_t\:\!}
\newcommand{\pdz}   {\partial_z}
\newcommand{\pdi}   {\partial_i}
\newcommand{\pdj}   {\partial_j}
\newcommand{\V}     {\ensuremath{\Omega}}
\newcommand{\dV}    {\,\partial\V}
\newcommand{\IntV}  {\int_{\V}}
\renewcommand{\S}   {\ensuremath{\Gamma}}
\newcommand{\dS}    {\,\partial\S}
\newcommand{\IntS}  {\int_{\S}}
\newcommand{\q}     {\ensuremath{q}}
\newcommand{\qi}    {\ensuremath{q_i}}

\DeclareMathOperator*{\Lim}{Lim}
\DeclareMathOperator {\Cos}{Cos}
\DeclareMathOperator {\Sin}{Sin}

\doublespacing

\begin{document}

\chapter{Theory}

The theory encompassed by this work can be divided into four basic parts: conservation laws, thermohydraulics, numerical methods, and stability.
Conservation laws, such as those for momentum and energy, form a fundamental basis of analysis in all branches of science.
Therefore, a precise definition for a generic conserved quantity and an associated conservation law will be given.
Following this generic treatment, the specific conservation laws for thermohydraulics will be presented.
Numerical methods for solving the thermohydraulic conservation laws will then be given.
Finally, the stability theory for the thermohydraulic system will be discussed.

\section{Conservation Laws}
\label{CLawDefinition}

\subsection{Scalar Form}
A conserved quantity \q{} refers to any physical property whose time evolution within an arbitrary, closed volume exactly balances with its surface fluxes and volume sources.
For the purpose of mathematical discussion and analysis, the conserved quantity \q{} will simultaneously represent a function of space and time that conforms to the requirements of the physical property.
These definitions define the following scalar conservation law over a volume \V{} with a closed surface \S{}:%
\begin{equation}%
    \pdt\!\IntV \q(x_i,t) \dV = \IntS -F_i(\q,x_i,t) n_i\dS + \IntV S(\q,x_i,t) \dV,
    \label{Eqn:GeneralIntegralCLaw}
\end{equation}
where $F_i$ is the surface flux of \q{}, $n_i$ is the outward unit normal of the surface \S{}, and $S$ is the volume source of \q{}.
Such that the units in the equation agree, both \q{} and $S$ are taken on a per volume basis and $F_i$ on a per area basis.
The negative sign in the surface integral ensures that outward fluxes act as sinks and inward fluxes as sources to the time evolution of \q{}'s volume integral.
\Cref{Eqn:GeneralIntegralCLaw} is the most general scalar conservation law that will be presented and is always physically valid regardless of the functions' behaviors.

A general conservation law can also be presented in differential form (i.e., as a differential equation).
First the Divergence Theorem is used to equate the surface integral in \cref{Eqn:GeneralIntegralCLaw} to a volume integral:
\begin{equation}
    \IntS -F_i(\q,x_i,t) n_i\dS = \IntV - \pdi F_i(\q,x_i,t) \dV.
    \label{Eqn:SurfToVol}
\end{equation}
Substituting \cref{Eqn:SurfToVol} into \cref{Eqn:GeneralIntegralCLaw} and moving all terms to the left-hand side gives:
\begin{equation}%
    \IntV \pdt\q(x_i,t) + \pdi F_i(\q,x_i,t) - S(\q,x_i,t) \dV = 0,
    \label{Eqn:PreDifferentialForm}
\end{equation}
where the time derivative operator could be moved into the integral since the volume is taken to be time-independent.
Since the integration volume in \cref{Eqn:PreDifferentialForm} is arbitrary, we take limit of the equality as the volume shrinks to a zero.
\begin{equation}%
    \Lim_{\V \rightarrow 0}\Biggl[\IntV \pdt\q(x_i,t) + \pdi F_i(\q,x_i,t) - S(\q,x_i,t) \dV \Biggr]= 0.
    \label{Eqn:LimitOfPreDifferentialForm}
\end{equation}
In this limit, the enforcement of the equality changes from one over a finite volume into one that is enforced at a particular point.
To ensure point-wise enforcement over a given domain, the integrand itself is required to be equally zero at every point in the domain; this yields the differential conservation law
\begin{equation}
    \pdt\q(x_i,t) + \pdi F_i(\q,x_i,t) - S(\q,x_i,t) = 0.
    \label{Eqn:GeneralDifferentialCLaw}
\end{equation}
When equipped with adequate boundary and initial data, this differential equation defines the requirement for all sufficiently smooth functions that describe how the conserved quantity evolves at every point in space-time.

The differential form may seem cleaner than the integral form, but \emph{it is not valid for all functional forms of \q{}}.
In transitioning from \cref{Eqn:LimitOfPreDifferentialForm} to \cref{Eqn:GeneralDifferentialCLaw}, it is assumed that all functions in the integrand remain bounded.
If any of the terms within the limit become infinite, the balance cannot be satisfied.
In particular, if \q{} has an area where it undergoes a discontinuous jump, called a shock, the gradient of the flux is infinite and the differential form is rendered invalid.
While methods that handle shocks in a robust fashion (shock-capturing schemes) are not the focus of this work, it is mentioned for completeness and consideration.

\subsection{Vector Form}
The simulation of real world problems often involves the solution of a system of conservation laws.
In general, the systems are nonlinear and tightly coupled.
The actual solution of these problems will be discussed in future sections, but the notation used will be introduced now.

The integral conservation law for a vector of conserved quantities \qi{} is
\begin{equation}%
    \pdt\!\IntV \qi(x_i,t) \dV = \IntS -F_{ij}(\qi,x_i,t) n_j\dS + \IntV S_i(\qi,x_i,t) \dV,
    \label{Eqn:GeneralIntegralCLawForSystems}
\end{equation}
where $F_{ij}$ is a matrix of surface fluxes of \qi{} in the $j$-th direction, $n_j$ is the outward unit normal of the surface \S{}, and $S_i$ is the volume source of \qi{}.
The integrals of the vector quantities represent element-wise integration.
A process similar to the scalar case also yields the differential form of the system conservation law:
\begin{equation}
    \pdt\qi(x_i,t) + \pdj F_{ij}(\qi,x_i,t) - S_i(\qi,x_i,t)  = 0,
    \label{Eqn:PreLimitGeneralIntegralCLawForSystems}
\end{equation}
where $\pdj F_{ij}$ represents a row-wise divergence operation.






\section{Law Derivations}

The derivations of the main equations used in thermohydraulics will be presented using the definitions above.
Mass, momentum, and energy are the primary quantities of interest and will be derived for an assumed flowing system.
For all of the definitions, the following items are noted:
\begin{itemize}
    \item{
        As prescribed in \cref{CLawDefinition}, all of the conserved quantities are taken to be continuous functions of space and time.
        Although fluids are actually composed of discrete, interacting molecules, taking the quantities to be everywhere-defined is a valid approximation as long as the length scales to be modeled are much greater than the mean free path of the local medium.
        \NeedReference{}
    }
    \item{
        Also as prescribed in \cref{CLawDefinition}, all of the conserved quantities will be considered on a per unit volume basis.
    }
    \item{
        For clarity, the dependence of all quantities and functions will be omitted; however, they are all assumed to be dependent of any variable in the system.
    }
\end{itemize}

\subsection{Conservation of Mass}
The net mass in a control volume or, rather, the volumed-integrated density is conserved as a simple scalar.
It is controlled by the background flow field advecting the mass through the boundary.
Therefore, the integral conservation law for density is
\begin{equation}
    \pdt\!\IntV \rho \dV = \IntS -(u_j \rho)n_j\dS + \IntV S^\rho\dV,
\end{equation}
with the differential form being
\begin{equation}
    \pdt \rho + \pdj (u_j \rho) = S^\rho.
\end{equation}

\subsection{Conservation of Momentum}
A control volume's momentum balance is more complicated than the simple in-out mass balance.
It is inherently a vector quantity, so the combination of mass and the background flow field feed the momentum in a non-linear fashion.
Also, even though a continuum approximation has been made, there still physical molecular stresses on the boundary must be modeled in some way.
Lastly, a body force must be added to account for buoyancy effects on the volume relative to the outside universe.
With all of the above nuances considered, the integral conservation for momentum is taken to be
\begin{equation}
    \pdt \IntV \rho u_i \dV = \IntS (-u_j \rho u_i) n_j \dS + \IntS (-\delta_{ij} P + \tau_{ij}) n_j \dS + \IntV \rho g_i + S^{\rho{u}}_i \dV,
    \label{Eqn:IntegralCoP}
\end{equation}
where $\rho{u_i}$ is the momentum in direction $i$, $u_j$ is the velocity in direction $j$, $\delta_{ij}$ is the Kronecker delta, $P$ is the thermodynamic pressure, $\tau_{ij}$ is the viscous stress tensor, and $g_i$ is the gravitational acceleration in direction $i$.

Each of the terms on the right-hand side of \cref{Eqn:IntegralCoP} stems from the considerations made.
The first integral represents how the background flow field transports the momentum across the volume's surface.
The second integral accounts for all of the molecular stresses present in the volume.
The pressure is an ever-present, thermodynamic property of the medium, and the tensor $\tau_{ij}$ accounts for all molecular friction and other deviations from thermodynamic equilibrium.
There are several models for the stress tensor, but none will be specified here.
The last integral has a source of momentum due to the mass of the volume in addition to the general source $S^{\rho{u}}$.
The accompanying differential equation is 
\begin{equation}
    \pdt (\rho u_i) + \pdj(u_j \rho u_i) = -\pdi P + \pdj\tau_{ij} + \rho g_i + S^{\rho{u}}_i.
\end{equation}



\subsection{Conservation of Energy}
The energy equation is similar to the momentum equation since there are non-linear and molecular components to the balance.
The energy to be balanced is the \textit{total energy} $\rho{e}$of the medium, where total means the sum of thermal, kinetic, and potential energies.
The integral conservation for total energy is taken to be
\begin{equation}
    \pdt \IntV \rho e_i \dV = \IntS u_i (-\rho e - \delta_{ij}P + \tau_{ij}) n_j \dS - \IntS q_j n_j\dS + \IntV \rho g_i + S^{\rho{e}} \dV,
    \label{Eqn:IntegralCoE}
\end{equation}




\section{Thermohydraulics}
\subsection{Base Equations}
\subsection{Generic Bulk Flow}
The set of conservation equations for a fluid in three dimensional form using index notation is 
\begin{subequations}\label{Eqn:3DCLaw}
    \begin{align}
        \pdt \rho + \pdj(\rho{u}_j) &= S_{\rho} \\
        \pdt \rho{u}_i + \pdj (\rho{u}_i u_j - \sigma_{ij}) + \pdi P  &= \rho\,g_i + S_{\rho{u}} \\
        \pdt \rho{e} + \pdj \left[u_j (\rho{e} + P)\right] - \pdj (u_i\sigma_{ij}) &= S_{\rho{e}},
    \end{align}
\end{subequations}
where $\rho$ is density, $u$ is velocity, $g$ is the gravity vector, $e$ is the total energy of flow, $P$ is the thermodynamic pressure, $\sigma_{ij}$ is the viscous stress tensor, and $S_{\ast}$ are arbitrary sinks or sources.
Integration of \cref{Eqn:3DCLaw} over some arbitrary, time-independent volume \V{} with boundary $\Gamma$ yields
\begin{subequations}
    \begin{equation}
        \pdt \IntV \rho \dV+ \IntV \pdj(\rho{u}_j) \dV = \IntV S_{\rho} \dV 
    \end{equation}
    \begin{equation}
        \pdt \IntV\rho{u}_i\dV + \IntV\pdj (\rho{u}_i u_j - \sigma_{ij}) + \pdi P \dV = \IntV\rho\,g_i + S_{\rho{u}}\dV
    \end{equation}
    \begin{equation}
        \pdt \IntV\rho{e}\dV + \IntV\pdj \left[u_j (\rho{e} + P)\right] - \pdj (u_i\sigma_{ij}) \dV= \IntV S_{\rho{e}}\dV.
    \end{equation}
    \label{Eqn:3DCLawIntV}
\end{subequations}
The unweighted volume average of a quantity $\alpha$ is denoted by $\bar{\alpha}$ and defined as
\begin{equation}
    \bar{\alpha} = \frac{1}{\V}\IntV \alpha \dV.
\end{equation}
Using this defintion, division of \cref{Eqn:3DCLawIntV} by \V{} and transformation of the volume integrals of spatial derivatives into surface integrals via the Divergence Theorem gives
\begin{subequations}
    \begin{equation}
        \pdt \bar{\rho}+ \oneo{\V} \IntS \rho{u}_j n_j \dS = \bar{S}_{\rho} 
    \end{equation}
    \begin{equation}
        \pdt \bar{\rho{u}}_i + \oneo{\V}\IntS (\rho{u}_i u_j - \sigma_{ij}) n_j \dS + 
        \oneo{\V}\IntS P n_i \dS = \bar{\rho}g_i + \bar{S}_{\rho{u}}
    \end{equation}
    \begin{equation}
        \pdt \bar{\rho{e}} + \oneo{\V}\IntS \left[u_j (\rho{e} + P) - u_i\sigma_{ij}\right]n_j \dS= \bar{S}_{\rho{e}},
    \end{equation}
    \label{Eqn:3DCLawIntegralForm}
\end{subequations}
where $n$ denotes the outward unit normal of the surface \S{}.
\Cref{Eqn:3DCLawIntegralForm} is the general, three-dimensional control volume form of the considered conservation equations.

\subsection{Channel Flow}

\section{Numerical Methods}
\section{Stability Theory}

\end{document}

